# [B站防剧透进度条](https://greasyfork.org/zh-CN/scripts/411092) 更新日志

本日志只记录用户友好的更新说明，影响不大的问题修复与修改不作记录，具体修改见 [提交记录](https://gitee.com/liangjiancang/userscript/commits/master/script/BilibiliNoSpoilProgressBar)。

## V2.1

1. 脚本：优化切换分P、页面内切换视频、播放器刷新等各种情况下重新初始化的处理。
2. 隐藏分P信息：优化处理流程。
3. UI：修复显示被 V3 播放器遮挡的问题。
4. UI：优化文字排版。
5. UI：优化布局。
6. 代码：弃用事件处理器属性。
7. 代码：引入类字段声明。
8. 代码：引入逻辑空赋值运算符 `??=`。
9. API：升级至 V1.8，大幅优化元素等待逻辑，引入网络请求检查、解析、报告功能。详见 [UserscriptAPI 更新日志](https://gitee.com/liangjiancang/userscript/blob/master/lib/UserscriptAPI/changelog.md)。

## V2.0

1. 脚本：更改伪进度条的实现方式，自给自足，不再借用B站原生的进度条组件。
2. 脚本：完善脚本菜单运行流程。
3. 脚本：优化初始化流程。
4. 功能实现：隐藏分段信息。
5. 功能移除：隐藏「热度」曲线。现在总是隐藏。
6. 用户设置：优化内部处理逻辑。
7. 代码：优先使用函数声明而非函数表达式来定义内部函数。
8. 代码：`no-useless-call`。
9. API：升级至 V1.4。详见 [UserscriptAPI 更新日志](https://gitee.com/liangjiancang/userscript/blob/master/lib/UserscriptAPI/changelog.md)。

## V1.9

1. 脚本：适配番剧播放页中，播放器升级至 `v3.0` 的改版，重新支持番剧播放页。
2. 脚本：移除对 `unsafeWindow` 的依赖，不再需要对网页的完整访问权限。
3. 脚本：大幅简化页面切换处理流程。
4. 脚本：优化 URL 匹配。
5. 脚本：明确不支持分段进度条——主要是因为按目前的实现方式要支持分段进度条非常困难。另一方面，既然UP主在某视频启用了分段进度条，本身就说明该视频向观众提供章节并不影响体验，换句话说这种视频理应是没有剧透问题的；否则，UP主才是「剧透」的元凶。以后可能会采用更合理的实现方式将脚本重写一遍，到时候也许会重新考虑支持分段进度条。
6. 用户设置：优化布局。
7. UI：优化脚本控制的外观。

## V1.8

1. 脚本：借助新版 API 对一些特殊情况（如网速不佳、打开大量视频到后台）下的处理进行大幅优化。
2. 脚本：优化错误处理流程。
3. 脚本：优化页面切换处理流程。
4. 脚本：优化脚本菜单运行流程。
5. 脚本：修复数值类型配置项无法保存为 `0` 的问题。
6. 脚本：主要逻辑推迟至 `load` 事件执行。
7. API：升级至 V1.3，进一步优化条件等待和元素等待逻辑。详见 [UserscriptAPI 更新日志](https://gitee.com/liangjiancang/userscript/blob/master/lib/UserscriptAPI/changelog.md)。
8. 代码：优化异常处理。

## V1.7

1. API：升级至 V1.1，大幅优化条件等待逻辑，优化元素等待逻辑。详见 [UserscriptAPI 更新日志](https://gitee.com/liangjiancang/userscript/blob/master/lib/UserscriptAPI/changelog.md)。
2. 脚本：优化脚本菜单运行流程。
3. 代码：引入可选链操作符 `?.` 及空值合并运算符 `??`。

## V1.6

1. API：升级至 V1.0，大幅优化元素等待逻辑。详见 [UserscriptAPI 更新日志](https://gitee.com/liangjiancang/userscript/blob/master/lib/UserscriptAPI/changelog.md)。
2. 脚本：大幅优化防剧透处理流程，提高运行效率，并避免在没有启用功能时执行大量无意义的逻辑。
3. 脚本：优化脚本菜单运行流程。
4. 脚本：优化配置保存流程。
5. 脚本：改用 Tampermonkey 引入的 urlchange 事件对 URL 变化进行跟踪（采用旧版逻辑对 Violentmonkey 作兼容）。
6. 脚本：移除过于陈旧的版本更新处理，并优化之。
7. 防剧透UP主名单：将UP主加入名单时备注名字。
8. 防剧透UP主名单：保存时对名单内容修正。
9. 防剧透UP主名单：修复空名单无法保存的问题。
10. 初始化脚本：不再重置「防剧透UP主名单」。
11. UI：优化文本。

## V1.5

1. 脚本：适配 20210624 的B站播放页面的超级脑残且越改越难用的升级。
2. 脚本：不再显式提醒脚本兼容问题。
3. 功能移除：功能性更新后打开设置页面。现在总是强制打开功能性更新设置。

> B站产品经理是吃💩的吗？现在 APP 已经被抖音化得连💩都不如，求你们放过网页版吧……

## V1.4

1. 功能实现：隐藏分P信息。

## V1.3

1. 脚本：兼容性处理。
2. 脚本：进一步修复打开稍后再看播放页面后长时间放置而没有切换过去，导致脚本逻辑执行失败的问题。
3. 防剧透UP主名单：修复在稍后再看模式播放页上无法正常工作的问题。
4. 进度条偏移时间点延后：无论是否延后，若偏移后滑块处于预留区内，立即更新进度条状态。
5. UI：优化进度条上的脚本控制的显示，避免遮盖其他视频信息。
6. 代码：配置默认值、极值硬编码进 `configMap` 中，而不再作为脚本常量看待。

## V1.2

1. 功能实现：进度条极端偏移因子，用于控制进度条偏移量的概率分布。
2. 防剧透进度条：检测滑块而非已播放条的变化，来更新伪已播放条。这样可以减少监听器的数量，同时避免交叉监听的问题。
3. 防剧透进度条：修复视频控制显示/隐藏状态切换检测错误，从而导致进度条没有在所有正确的时间点发生偏移的问题。
4. 防剧透进度条：修复在番剧播放页切换分P后无法重新执行处理逻辑的问题。
5. 进度条偏移时间点延后：修复打开页面后，首次启用防剧透进度条时已播放进度不正确的问题。

## V1.1

1. 脚本：修复打开播放页面后长时间放置而没有切换过去，导致脚本逻辑执行失败的问题。
2. 防剧透机制：修改进度条偏移与播放进度的耦合关系，现在播放进度不再直接影响偏移量的大小。
3. 功能实现：延后进度条偏移的时间点，用于防止用户从视觉上直观推测出偏移方向与偏移量。
4. 防剧透进度条：调整默认参数，加强默认的防剧透强度。

## V1.0

1. 功能实现：视频播放页、番剧播放页实现防剧透进度条。
2. 功能实现：防剧透UP主名单。
3. 功能实现：番剧自动启用防剧透进度条。
